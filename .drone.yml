kind: pipeline
name: default

platform:
  os: linux
  arch: amd64

steps:
  - name: Build & Publish
    pull: if-not-exists
    image: 714782054810.dkr.ecr.eu-west-2.amazonaws.com/base-images/qe-ruby:2.7.0
    commands:
      - apk add --update git --update alpine-sdk  --no-cache
      - gem install bundler
      - bundle
      - gem install nexus
      - gem build parallel_report_portal.gemspec
      - gem nexus --url https://nexus.tooling.dvla.gov.uk/repository/gem-private/ parallel_report_portal*gem
    environment:
      NEXUS_PASSWORD:
        from_secret: NEXUS_PASSWORD
      NEXUS_USER:
        from_secret: NEXUS_USER
    when:
      branch:
        - master